</br>
<p data-i18n="pair.api_code.intro" style="text-align:left;"></p>
<p data-i18n="pair.api_code.intro1" style="text-align:left;"></p>
<p data-i18n="pair.api_code.intro2" style="text-align:left;"></p>
<p data-i18n="pair.api_code.intro3" style="text-align:left;"></p>
<p data-i18n="pair.api_code.intro4" style="text-align:left;"></p>
<p data-i18n="pair.api_code.intro5" style="text-align:left;"></p>

<form id="form" name="form" onsubmit="return getForm()" action="javascript:void(0);" method="post" style="text-align:left;">
    <div class="form-group">
        <label for="api_code" data-i18n="pair.api_code.api_code"></label>
        <input type="text" name="api_code" id="api_code" />
        </br>
        <input type="submit" id="submit" value="Log In" style="margin: 15px; padding: 10px; text-align:center; color: white; background-color: rgb(15, 170, 36);border-radius: 5px" />
        </br>
        </br>
        <input type="text" id="status" readonly />
    </div>
</form>


<script type="text/javascript">
    Homey.setTitle(__('pair.api_code.title'));

    Homey.emit('api_code_setup', {}).then(function(result)
    {
        document.getElementById('api_code').value = result;
    });

    function getForm()
    {
        // Mark as authenticating
        document.getElementById('submit').disabled = 'disabled';
        document.getElementById('submit').value = __('pair.api_code.checking');

        Homey.emit('api_connection', {api_token: document.forms.form.api_code.value}).then(function(result)
        {
            if (result)
            {
                console.log('authentication succeeded');
                document.getElementById('submit').value = __('pair.api_code.correct');
                document.getElementById('status').value = __('pair.api_code.adding');
                document.getElementById('status').style.color = 'green';
                Homey.showView("list_my_devices");
            }
            else
            {
                console.log('authentication failed');
                document.getElementById('submit').disabled = false;
                document.getElementById('submit').value = __('pair.api_code.try_again');
                document.getElementById('status').value = err;
                document.getElementById('status').style.color = 'red';
            }
        })
        .catch(function(err)
        {
            console.log('authentication failed');
            document.getElementById('submit').disabled = false;
            document.getElementById('submit').value = __('pair.api_code.try_again');
            document.getElementById('status').value = err.message;
            document.getElementById('status').style.color = 'red';
        });
    }
</script>